# å°è¯´è‡ªåŠ¨åŒ–å¤„ç†ç³»ç»Ÿå¼€å‘æ–‡æ¡£

> **é¡¹ç›®åç§°**: Novel Processing System (å°è¯´è‡ªåŠ¨åŒ–å¤„ç†ç³»ç»Ÿ)
>
> **ç‰ˆæœ¬**: 2.0.0 (API åŒ–æ”¹é€ å®Œæˆ)
>
> **å¼€å‘æ—¥å¿—**: Phase 2 - å‰åç«¯åˆ†ç¦» API åŒ–æ”¹é€ 

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [å¼€å‘å†ç¨‹](#å¼€å‘å†ç¨‹)
4. [Phase 2: API åŒ–æ”¹é€ è¯¦è§£](#phase-2-api-åŒ–æ”¹é€ è¯¦è§£)
5. [æ ¸å¿ƒæ¨¡å—è¯´æ˜](#æ ¸å¿ƒæ¨¡å—è¯´æ˜)
6. [API æ¥å£æ–‡æ¡£](#api æ¥å£æ–‡æ¡£)
7. [æµ‹è¯•è¯´æ˜](#æµ‹è¯•è¯´æ˜)
8. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
9. [æŠ€æœ¯å†³ç­–è®°å½•](#æŠ€æœ¯å†³ç­–è®°å½•)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç›®æ ‡

æ„å»ºä¸€ä¸ªå®Œæ•´çš„**å°è¯´è‡ªåŠ¨åŒ–å¤„ç†ç³»ç»Ÿ**ï¼Œèƒ½å¤Ÿï¼š
- ä»å°è¯´æ–‡æœ¬ä¸­è‡ªåŠ¨æå–äººç‰©ã€å…³ç³»å’Œæ—¶é—´çº¿äº‹ä»¶
- å°†å°è¯´å†…å®¹è½¬æ¢ä¸ºå‰§æœ¬æ ¼å¼
- ç”Ÿæˆåˆ†é•œé•œå¤´æè¿°
- æ”¯æŒé•¿ç¯‡å°è¯´çš„åˆ†å—å¤„ç†å’Œè®°å¿†åˆå¹¶

### æ ¸å¿ƒä»·å€¼

| åŠŸèƒ½ | æè¿° |
|------|------|
| äººç‰©æå– | è¯†åˆ«å°è¯´ä¸­çš„è§’è‰²ï¼Œæå–æ€§æ ¼ã€ç›®æ ‡ã€å¤–è²Œç­‰ç‰¹å¾ |
| å…³ç³»åˆ†æ | åˆ†æäººç‰©ä¹‹é—´çš„å…³ç³»ç±»å‹ã€å†²çªç­‰çº§å’Œå…³ç³»å¼ºåº¦ |
| æ—¶é—´çº¿æ¢³ç† | æŒ‰ç« èŠ‚æå–å…³é”®äº‹ä»¶ï¼Œæ„å»ºæ•…äº‹æ—¶é—´çº¿ |
| å‰§æœ¬ç”Ÿæˆ | å°†å°è¯´å™è¿°è½¬æ¢ä¸ºæ ‡å‡†å‰§æœ¬æ ¼å¼ |
| åˆ†é•œç”Ÿæˆ | å°†å‰§æœ¬åœºæ™¯æ‹†è§£ä¸ºå¯æ‹æ‘„çš„åˆ†é•œé•œå¤´ |

---

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   CLI å‘½ä»¤è¡Œ â”‚  â”‚  FastAPI   â”‚  â”‚   å‰ç«¯åº”ç”¨  â”‚              â”‚
â”‚  â”‚  (main.py)  â”‚  â”‚  (api.py)  â”‚  â”‚   (å¾…å¼€å‘)  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å¤„ç†æµæ°´çº¿å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              LongNovelProcessor (é•¿ç¯‡å°è¯´å¤„ç†å™¨)          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  NovelReaderâ”‚  â”‚ChunkingEngineâ”‚  â”‚  MemoryBank    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  (å°è¯´è¯»å–)  â”‚  â”‚  (åˆ†å—å¼•æ“)  â”‚  â”‚  (è®°å¿†é“¶è¡Œ)     â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¿¡æ¯æå–å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Character  â”‚  â”‚Relationship â”‚  â”‚  Timeline   â”‚              â”‚
â”‚  â”‚  Extractor  â”‚  â”‚ Extractor   â”‚  â”‚  Extractor  â”‚              â”‚
â”‚  â”‚  (äººç‰©æå–) â”‚  â”‚  (å…³ç³»æå–) â”‚  â”‚  (æ—¶é—´çº¿æå–)â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å†…å®¹ç”Ÿæˆå±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   ScriptGenerator   â”‚  â”‚  StoryboardGeneratorâ”‚               â”‚
â”‚  â”‚    (å‰§æœ¬ç”Ÿæˆå™¨)      â”‚  â”‚    (åˆ†é•œç”Ÿæˆå™¨)      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åŸºç¡€è®¾æ–½å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   LLM       â”‚  â”‚   Vector    â”‚  â”‚   File      â”‚              â”‚
â”‚  â”‚  Client     â”‚  â”‚   Store     â”‚  â”‚   System    â”‚              â”‚
â”‚  â”‚  (LLM å®¢æˆ·ç«¯)â”‚  â”‚  (å‘é‡å­˜å‚¨) â”‚  â”‚  (æ–‡ä»¶ç³»ç»Ÿ) â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ |
|------|----------|
| Web æ¡†æ¶ | FastAPI 0.104+ |
| ASGI æœåŠ¡å™¨ | Uvicorn 0.24+ |
| æ•°æ®éªŒè¯ | Pydantic 2.0+ |
| LLM è°ƒç”¨ | OpenAI SDK 1.3+ |
| å‘é‡åŒ–è®°å¿† | è‡ªç ” VectorMemoryBank |
| æµ‹è¯•æ¡†æ¶ | pytest 7.4+ |

---

## å¼€å‘å†ç¨‹

### Phase 1: æ ¸å¿ƒæ•°æ®ç»“æ„å®šä¹‰ âœ…

**ç›®æ ‡**: å®šä¹‰ç³»ç»Ÿä½¿ç”¨çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹

**å®Œæˆå†…å®¹**:
- `models.py` - å®šä¹‰ 5 ä¸ªæ ¸å¿ƒå®ä½“ç±»
  - `Character` - äººç‰©å®ä½“
  - `Relationship` - äººç‰©å…³ç³»å®ä½“
  - `TimelineEvent` - æ—¶é—´çº¿äº‹ä»¶å®ä½“
  - `ScriptScene` - å‰§æœ¬åœºæ™¯å®ä½“
  - `StoryboardShot` - åˆ†é•œé•œå¤´å®ä½“

**æµ‹è¯•æ–‡ä»¶**: `test_phase1_models.py` (10 ä¸ªæµ‹è¯•ç”¨ä¾‹)

### Phase 2: ä¿¡æ¯æå–å¼•æ“ (NLU) âœ…

**ç›®æ ‡**: å®ç°å°è¯´ä¿¡æ¯çš„æ™ºèƒ½æå–

**å®Œæˆå†…å®¹**:
- `extractor.py` - LLM é©±åŠ¨çš„ä¿¡æ¯æå–å¼•æ“
  - `LLMClient` - æŠ½è±¡å®¢æˆ·ç«¯æ¥å£
  - `OpenAICompatibleClient` - OpenAI å…¼å®¹å®¢æˆ·ç«¯ï¼ˆæ”¯æŒè‡ªåŠ¨é‡è¯•ï¼‰
  - `CharacterExtractor` - äººç‰©æå–å™¨
  - `RelationshipExtractor` - å…³ç³»æå–å™¨
  - `TimelineExtractor` - æ—¶é—´çº¿æå–å™¨

**æµ‹è¯•æ–‡ä»¶**: `test_phase2_extractor.py` (10 ä¸ªæµ‹è¯•ç”¨ä¾‹)

### Phase 3: å‰§æœ¬ç”Ÿæˆæ¨¡å— âœ…

**ç›®æ ‡**: å°†æ—¶é—´çº¿äº‹ä»¶è½¬æ¢ä¸ºå‰§æœ¬æ ¼å¼

**å®Œæˆå†…å®¹**:
- `script_generator.py` - å‰§æœ¬ç”Ÿæˆå™¨
  - åŸºäº LLM çš„æ™ºèƒ½ç”Ÿæˆ
  - æ”¯æŒè®°å¿†ä¸Šä¸‹æ–‡æ³¨å…¥
  - å®Œæ•´çš„åœºæ™¯æè¿°å’Œå¯¹è¯ç”Ÿæˆ

**æµ‹è¯•æ–‡ä»¶**: `test_phase3_script_generator.py` (7 ä¸ªæµ‹è¯•ç”¨ä¾‹)

### Phase 4: åˆ†é•œè½¬åŒ–æ¨¡å— âœ…

**ç›®æ ‡**: å°†å‰§æœ¬åœºæ™¯æ‹†è§£ä¸ºåˆ†é•œé•œå¤´

**å®Œæˆå†…å®¹**:
- `storyboard_generator.py` - åˆ†é•œç”Ÿæˆå™¨
  - è‡ªåŠ¨é•œå¤´ç±»å‹åˆ¤æ–­
  - æ‘„åƒæœºæ–¹å‘å»ºè®®
  - éŸ³é¢‘æ–¹å‘å»ºè®®
  - æ—¶é•¿ä¼°ç®—

**æµ‹è¯•æ–‡ä»¶**: `test_phase4_storyboard.py` (9 ä¸ªæµ‹è¯•ç”¨ä¾‹)

### Phase 5: ç³»ç»Ÿæµæ°´çº¿æ•´åˆ âœ…

**ç›®æ ‡**: ä¸²è”æ‰€æœ‰æ¨¡å—ï¼Œæ”¯æŒé•¿ç¯‡å°è¯´å¤„ç†

**å®Œæˆå†…å®¹**:
- `main.py` - å®Œæ•´CLIå’Œæµæ°´çº¿
  - `NovelProcessor` - æ ‡å‡†å¤„ç†å™¨
  - `LongNovelProcessor` - é•¿ç¯‡å°è¯´å¤„ç†å™¨
- `chunking_engine.py` - æ™ºèƒ½åˆ†å—å¼•æ“
  - æ”¯æŒä¸­è‹±æ–‡ç« èŠ‚è¯†åˆ«
  - è®°å¿†é“¶è¡Œ (MemoryBank)
  - æ£€æŸ¥ç‚¹ä¿å­˜/æ¢å¤
- `vector_store.py` - å‘é‡åŒ–è®°å¿†é“¶è¡Œ
  - è§£å†³è®°å¿†è†¨èƒ€é—®é¢˜
  - æ™ºèƒ½æ£€ç´¢ç›¸å…³è®°å¿†

**æµ‹è¯•æ–‡ä»¶**: `test_phase5_pipeline.py` (5 ä¸ªæµ‹è¯•ç”¨ä¾‹)

### Phase 6: API åŒ–æ”¹é€  âœ… (å½“å‰é˜¶æ®µ)

**ç›®æ ‡**: å‰åç«¯åˆ†ç¦»ï¼Œæä¾› RESTful API

**å®Œæˆå†…å®¹**:
- `api.py` - FastAPI Web æœåŠ¡å±‚
  - å¼‚æ­¥ä»»åŠ¡å¤„ç†
  - å†…å­˜ TaskStore
  - å®Œæ•´çš„ RESTful ç«¯ç‚¹
  - CORS è·¨åŸŸæ”¯æŒ
- `requirements.txt` - Python ä¾èµ–ç®¡ç†
- `test_api.py` - API æ¥å£æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `test_api.py` (16 ä¸ªæµ‹è¯•ç”¨ä¾‹)

---

## Phase 2: API åŒ–æ”¹é€ è¯¦è§£

### æ”¹é€ åŠ¨æœº

åŸæœ‰çš„ `main.py` æ˜¯çº¯å‘½ä»¤è¡Œå·¥å…·ï¼Œå­˜åœ¨ä»¥ä¸‹é™åˆ¶ï¼š
1. **é˜»å¡å¼æ‰§è¡Œ**: ç”¨æˆ·å¿…é¡»ç­‰å¾…æ•´ä¸ªå¤„ç†å®Œæˆæ‰èƒ½ç»§ç»­
2. **æ— çŠ¶æ€**: æ— æ³•ä¸­é€”æŸ¥è¯¢è¿›åº¦æˆ–æš‚åœ
3. **æ— æ³•é›†æˆ**: éš¾ä»¥è¢«å‰ç«¯æˆ–å…¶ä»–ç³»ç»Ÿè°ƒç”¨
4. **æ— é”™è¯¯æ¢å¤**: ç¨‹åºå´©æºƒåä¸¢å¤±æ‰€æœ‰è¿›åº¦

### è®¾è®¡æ–¹æ¡ˆ

#### 1. å¼‚æ­¥ä»»åŠ¡æ¨¡å‹

```
HTTP POST /api/v1/novel/upload
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  åˆ›å»ºä»»åŠ¡   â”‚ â†â”€â”€ ç«‹å³è¿”å› task_id
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Background  â”‚
    â”‚   Tasks     â”‚ â†â”€â”€ åå°å¼‚æ­¥æ‰§è¡Œ
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ›´æ–°çŠ¶æ€    â”‚
    â”‚ PENDING â†’   â”‚
    â”‚ PROCESSING â†’â”‚
    â”‚ COMPLETED   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. ä»»åŠ¡çŠ¶æ€æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING â”‚ â”€â”€â–º â”‚ PROCESSING â”‚ â”€â”€â–º â”‚ COMPLETED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚
                     â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  FAILED   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. TaskStore è®¾è®¡

```python
class TaskStore:
    """å†…å­˜ä»»åŠ¡å­˜å‚¨ï¼ˆç”Ÿäº§ç¯å¢ƒå¯æ›¿æ¢ä¸º Redisï¼‰"""

    def create_task(task_id: str) -> Dict
    def get_task(task_id: str) -> Optional[Dict]
    def update_task(task_id: str, **kwargs) -> Optional[Dict]
    def set_result(task_id: str, result: Dict) -> bool
    def cleanup_task(task_id: str) -> None
```

### æ ¸å¿ƒä»£ç ç»“æ„

```
api.py
â”œâ”€â”€ æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ TaskStatus (Enum)
â”‚   â”œâ”€â”€ TaskInfo (Pydantic)
â”‚   â”œâ”€â”€ TaskResult (Pydantic)
â”‚   â”œâ”€â”€ UploadResponse (Pydantic)
â”‚   â””â”€â”€ ErrorResponse (Pydantic)
â”‚
â”œâ”€â”€ TaskStore (ä»»åŠ¡å­˜å‚¨)
â”‚
â”œâ”€â”€ FastAPI åº”ç”¨
â”‚   â”œâ”€â”€ CORS ä¸­é—´ä»¶é…ç½®
â”‚   â”œâ”€â”€ å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ get_long_novel_processor()
â”‚   â”‚   â””â”€â”€ process_novel_background()
â”‚   â”‚
â”‚   â””â”€â”€ API ç«¯ç‚¹
â”‚       â”œâ”€â”€ GET /
â”‚       â”œâ”€â”€ GET /api/v1/health
â”‚       â”œâ”€â”€ POST /api/v1/novel/upload
â”‚       â”œâ”€â”€ GET /api/v1/tasks/{task_id}
â”‚       â”œâ”€â”€ GET /api/v1/tasks/{task_id}/result
â”‚       â””â”€â”€ DELETE /api/v1/tasks/{task_id}
â”‚
â””â”€â”€ å¯åŠ¨é…ç½®
```

### å…³é”®å®ç°ç»†èŠ‚

#### 1. åå°ä»»åŠ¡æ‰§è¡Œ

ä½¿ç”¨ `threading.Thread` è€Œé FastAPI çš„ `BackgroundTasks`ï¼ŒåŸå› ï¼š
- `BackgroundTasks` åœ¨å“åº”è¿”å›åæ‰§è¡Œï¼Œä½†ä»åœ¨åŒä¸€è¯·æ±‚å‘¨æœŸå†…
- é•¿ç¯‡å°è¯´å¤„ç†å¯èƒ½è€—æ—¶æ•°åˆ†é’Ÿï¼Œéœ€è¦çœŸæ­£çš„åå°çº¿ç¨‹

```python
import threading

def run_background_task():
    process_novel_background(task_id, novel_path, output_path)

thread = threading.Thread(target=run_background_task)
thread.daemon = True
thread.start()
```

#### 2. ä¸´æ—¶æ–‡ä»¶ç®¡ç†

```python
# åˆ›å»ºä¸´æ—¶ç›®å½•
temp_dir = tempfile.mkdtemp(prefix=f"novel_{uuid.uuid4().hex[:8]}_")

# ä¿å­˜ä¸Šä¼ æ–‡ä»¶
novel_path = os.path.join(temp_dir, file.filename)

# ä»»åŠ¡å®Œæˆåæ¸…ç†
task_store.cleanup_task(task_id)  # åˆ é™¤ä¸´æ—¶ç›®å½•
```

#### 3. é”™è¯¯å¤„ç†

```python
try:
    # å¤„ç†é€»è¾‘
    pass
except HTTPException:
    raise  # é‡æ–°æŠ›å‡º HTTP å¼‚å¸¸
except Exception as e:
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    if os.path.exists(temp_dir):
        shutil.rmtree(temp_dir)
    raise HTTPException(status_code=500, detail=str(e))
```

---

## æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. api.py - API æœåŠ¡å±‚

**ä½ç½®**: `E:\booktools\api.py`

**æ ¸å¿ƒç±»**:

| ç±»å | æè¿° |
|------|------|
| `TaskStatus` | ä»»åŠ¡çŠ¶æ€æšä¸¾ (PENDING, PROCESSING, COMPLETED, FAILED) |
| `TaskInfo` | ä»»åŠ¡ä¿¡æ¯å“åº”æ¨¡å‹ |
| `TaskResult` | ä»»åŠ¡ç»“æœå“åº”æ¨¡å‹ |
| `TaskStore` | å†…å­˜ä»»åŠ¡å­˜å‚¨ |

**ä¾èµ–æ³¨å…¥**:
```python
def get_long_novel_processor():
    """è·å– LongNovelProcessor å®ä¾‹"""
    from main import LongNovelProcessor, create_llm_client
    llm_client = create_llm_client()
    return LongNovelProcessor(...)
```

### 2. main.py - æ ¸å¿ƒæµæ°´çº¿

**ä½ç½®**: `E:\booktools\main.py`

**æ ¸å¿ƒç±»**:

| ç±»å | æè¿° |
|------|------|
| `NovelProcessor` | æ ‡å‡†å¤„ç†å™¨ï¼ˆé€‚åˆçŸ­ç¯‡ï¼‰ |
| `LongNovelProcessor` | é•¿ç¯‡å°è¯´å¤„ç†å™¨ï¼ˆæ”¯æŒåˆ†å—å’Œè®°å¿†åˆå¹¶ï¼‰ |

**å…³é”®æ–¹æ³•**:
```python
# LongNovelProcessor
def process_novel(file_path: str, output_path: str) -> Dict
def load_novel(file_path: str) -> List[TextChunk]
def process_chunk(chunk: TextChunk) -> Dict
```

### 3. chunking_engine.py - åˆ†å—å¼•æ“

**ä½ç½®**: `E:\booktools\chunking_engine.py`

**æ ¸å¿ƒç»„ä»¶**:

| ç»„ä»¶ | æè¿° |
|------|------|
| `NovelReader` | å°è¯´è¯»å–å’Œç« èŠ‚åˆ‡åˆ† |
| `MemoryBank` | è®°å¿†é“¶è¡Œï¼ˆä¼ ç»Ÿç‰ˆï¼‰ |
| `ChunkingPipeline` | åˆ†å—å¤„ç†æµæ°´çº¿ |

**ç« èŠ‚è¯†åˆ«æ­£åˆ™**:
```python
# æ”¯æŒå¤šç§æ ¼å¼
r'^ç¬¬ [ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾åƒ\d]+ç« '  # ä¸­æ–‡
r'^Chapter\s+\d+'                       # è‹±æ–‡
r'^CHAPTER\s+\d+'                       # è‹±æ–‡å¤§å†™
```

### 4. vector_store.py - å‘é‡åŒ–è®°å¿†

**ä½ç½®**: `E:\booktools\vector_store.py`

**è§£å†³çš„é—®é¢˜**:
- ä¼ ç»Ÿ MemoryBank å°†æ‰€æœ‰è®°å¿†ç›´æ¥æ‹¼æ¥ï¼Œå¯¼è‡´ä¸Šä¸‹æ–‡çˆ†ç‚¸
- VectorMemoryBank ä½¿ç”¨å‘é‡æ£€ç´¢ï¼Œåªè¿”å›ç›¸å…³è®°å¿†

**æ ¸å¿ƒæ–¹æ³•**:
```python
class VectorMemoryBank:
    def add_character(self, ...)  # æ·»åŠ äººç‰©è®°å¿†
    def add_relationship(self, ...)  # æ·»åŠ å…³ç³»
    def query(self, query: str, top_k: int) -> List  # å‘é‡æ£€ç´¢
    def to_context_prompt(self, current_text: str) -> str  # ç”Ÿæˆä¸Šä¸‹æ–‡
```

---

## API æ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8000`
- **API ç‰ˆæœ¬**: v1
- **æ–‡æ¡£åœ°å€**: `/docs` (Swagger UI)
- **å¤‡ç”¨æ–‡æ¡£**: `/redoc` (ReDoc)

### è®¤è¯

å½“å‰ç‰ˆæœ¬æ— éœ€è®¤è¯ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®æ·»åŠ  JWT è®¤è¯ï¼‰

### ç«¯ç‚¹è¯¦æƒ…

#### 1. å¥åº·æ£€æŸ¥

```http
GET /
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "service": "Novel Processing API",
  "version": "2.0.0",
  "status": "running",
  "docs": "/docs"
}
```

#### 2. ä¸Šä¼ å°è¯´

```http
POST /api/v1/novel/upload
Content-Type: multipart/form-data
```

**è¯·æ±‚å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| file | UploadFile | æ˜¯ | .txt æ ¼å¼å°è¯´æ–‡ä»¶ |

**æˆåŠŸå“åº” (200)**:
```json
{
  "task_id": "a1b2c3d4e5f6",
  "status": "pending",
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä»»åŠ¡å·²åˆ›å»ºå¹¶å¼€å§‹å¤„ç†"
}
```

**é”™è¯¯å“åº” (400)**:
```json
{
  "detail": "ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼štest.pdfï¼Œè¯·ä¸Šä¼  .txt æ ¼å¼çš„æ–‡ä»¶"
}
```

#### 3. æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```http
GET /api/v1/tasks/{task_id}
```

**è·¯å¾„å‚æ•°**:
| å‚æ•° | ç±»å‹ | æè¿° |
|------|------|------|
| task_id | string | ä»»åŠ¡å”¯ä¸€æ ‡è¯†ç¬¦ |

**æˆåŠŸå“åº” (200)**:
```json
{
  "task_id": "a1b2c3d4e5f6",
  "status": "processing",
  "progress": 50,
  "message": "æ­£åœ¨å¤„ç†ç« èŠ‚ï¼Œæå–äººç‰©å’Œå…³ç³»...",
  "created_at": "2024-01-01T10:00:00",
  "updated_at": "2024-01-01T10:01:00",
  "completed_at": null,
  "error_message": null
}
```

**é”™è¯¯å“åº” (404)**:
```json
{
  "detail": "ä»»åŠ¡ä¸å­˜åœ¨ï¼ša1b2c3d4e5f6"
}
```

#### 4. è·å–ä»»åŠ¡ç»“æœ

```http
GET /api/v1/tasks/{task_id}/result
```

**å‰ç½®æ¡ä»¶**: ä»»åŠ¡çŠ¶æ€å¿…é¡»ä¸º `COMPLETED`

**æˆåŠŸå“åº” (200)**:
```json
{
  "task_id": "a1b2c3d4e5f6",
  "status": "completed",
  "result": {
    "metadata": {...},
    "statistics": {...},
    "characters": [...],
    "relationships": [...],
    "timeline_events": [...],
    "script_scenes": [...],
    "storyboard_shots": [...]
  },
  "completed_at": "2024-01-01T10:05:00"
}
```

**é”™è¯¯å“åº” (400)**:
```json
{
  "detail": "ä»»åŠ¡å°šæœªå®Œæˆï¼Œå½“å‰çŠ¶æ€ï¼špending"
}
```

#### 5. åˆ é™¤ä»»åŠ¡

```http
DELETE /api/v1/tasks/{task_id}
```

**æˆåŠŸå“åº” (200)**:
```json
{
  "message": "ä»»åŠ¡ a1b2c3d4e5f6 å·²åˆ é™¤"
}
```

#### 6. å¥åº·æ£€æŸ¥ï¼ˆè¯¦ç»†ï¼‰

```http
GET /api/v1/health
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "healthy",
  "timestamp": "2024-01-01T10:00:00",
  "active_tasks": 5
}
```

---

## æµ‹è¯•è¯´æ˜

### æµ‹è¯•è¦†ç›–ç‡

| æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | ç”¨ä¾‹æ•° | çŠ¶æ€ |
|------|----------|--------|------|
| models.py | test_phase1_models.py | 10 | âœ… |
| extractor.py | test_phase2_extractor.py | 10 | âœ… |
| script_generator.py | test_phase3_script_generator.py | 7 | âœ… |
| storyboard_generator.py | test_phase4_storyboard.py | 9 | âœ… |
| main.py + chunking_engine.py | test_chunking_engine.py | 19 | âœ… |
| pipeline | test_phase5_pipeline.py | 5 | âœ… |
| api.py | test_api.py | 16 | âœ… |
| **æ€»è®¡** | | **76** | **âœ…** |

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest test_api.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
pytest test_api.py::TestTaskStore -v

# è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
pytest test_api.py::TestTaskStore::test_create_task -v

# æŸ¥çœ‹è¦†ç›–ç‡
pytest --cov=. --cov-report=html
```

### test_api.py æµ‹è¯•ç»“æ„

```
TestTaskStore
â”œâ”€â”€ test_create_task      # æµ‹è¯•åˆ›å»ºä»»åŠ¡
â”œâ”€â”€ test_get_task         # æµ‹è¯•è·å–ä»»åŠ¡
â”œâ”€â”€ test_update_task      # æµ‹è¯•æ›´æ–°ä»»åŠ¡
â”œâ”€â”€ test_set_result       # æµ‹è¯•è®¾ç½®ç»“æœ
â””â”€â”€ test_cleanup_task     # æµ‹è¯•æ¸…ç†ä»»åŠ¡

TestAPIEndpoints
â”œâ”€â”€ test_root             # æµ‹è¯•æ ¹è·¯å¾„
â”œâ”€â”€ test_health_check     # æµ‹è¯•å¥åº·æ£€æŸ¥
â”œâ”€â”€ test_get_task_not_found  # æµ‹è¯• 404
â”œâ”€â”€ test_get_task_status  # æµ‹è¯•æŸ¥è¯¢çŠ¶æ€
â”œâ”€â”€ test_delete_task      # æµ‹è¯•åˆ é™¤ä»»åŠ¡
â”œâ”€â”€ test_get_result_task_not_completed  # æµ‹è¯•æœªå®Œæˆç»“æœ
â”œâ”€â”€ test_get_result_success  # æµ‹è¯•æˆåŠŸè·å–ç»“æœ
â””â”€â”€ test_upload_novel_wrong_format  # æµ‹è¯•é”™è¯¯æ ¼å¼

TestUploadAndProcess
â”œâ”€â”€ test_upload_novel_success  # æµ‹è¯•ä¸Šä¼ æˆåŠŸ
â””â”€â”€ test_full_workflow    # æµ‹è¯•å®Œæ•´æµç¨‹

TestLongNovelProcessorIntegration
â””â”€â”€ test_processor_initialization  # æµ‹è¯•å¤„ç†å™¨åˆå§‹åŒ–
```

---

## éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒ

```bash
# 1. å…‹éš†ä»“åº“
git clone <repo-url>
cd booktools

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ LLM_API_KEY ç­‰é…ç½®

# 5. è¿è¡Œæµ‹è¯•
pytest -v

# 6. å¯åŠ¨ API æœåŠ¡
python api.py
# æˆ–
uvicorn api:app --reload
```

### ç”Ÿäº§ç¯å¢ƒ

#### 1. Docker éƒ¨ç½²

```dockerfile
FROM python:3.12-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["uvicorn", "api:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
```

```bash
# æ„å»ºé•œåƒ
docker build -t novel-processor:latest .

# è¿è¡Œå®¹å™¨
docker run -d -p 8000:8000 \
  -e LLM_API_KEY=your_key \
  -e LLM_BASE_URL=your_url \
  novel-processor:latest
```

#### 2. Systemd æœåŠ¡ (Linux)

```ini
# /etc/systemd/system/novel-processor.service
[Unit]
Description=Novel Processing API
After=network.target

[Service]
Type=notify
User=novel
Group=novel
WorkingDirectory=/opt/novel-processor
Environment="PATH=/opt/novel-processor/venv/bin"
ExecStart=/opt/novel-processor/venv/bin/uvicorn api:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable novel-processor
sudo systemctl start novel-processor
```

#### 3. ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å | æè¿° | é»˜è®¤å€¼ |
|--------|------|--------|
| `LLM_API_KEY` | LLM API å¯†é’¥ | - |
| `LLM_BASE_URL` | LLM API åŸºç¡€ URL | - |
| `LLM_MODEL` | æ¨¡å‹åç§° | `gpt-4o-mini` |
| `OUTPUT_INDENT` | JSON ç¼©è¿› | `true` |

---

## æŠ€æœ¯å†³ç­–è®°å½•

### å†³ç­– 1: é€‰æ‹© FastAPI è€Œé Flask

**æ—¶é—´**: 2024-01-01

**èƒŒæ™¯**: éœ€è¦ä¸ºç³»ç»Ÿè®¾è®¡ Web API å±‚

**é€‰é¡¹å¯¹æ¯”**:
| ç‰¹æ€§ | FastAPI | Flask |
|------|---------|-------|
| å¼‚æ­¥æ”¯æŒ | åŸç”Ÿ | éœ€æ‰©å±• |
| è‡ªåŠ¨æ–‡æ¡£ | âœ… | âŒ |
| æ•°æ®éªŒè¯ | Pydantic å†…ç½® | éœ€æ‰©å±• |
| æ€§èƒ½ | é«˜ | ä¸­ |
| ç±»å‹å®‰å…¨ | âœ… | âŒ |

**å†³ç­–**: é€‰æ‹© FastAPI

**ç†ç”±**:
1. åŸç”Ÿå¼‚æ­¥æ”¯æŒï¼Œé€‚åˆé•¿è€—æ—¶ä»»åŠ¡
2. è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£ï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬
3. Pydantic æä¾›å¼ºç±»å‹éªŒè¯
4. æ›´å¥½çš„ç°ä»£ Python æ”¯æŒ

### å†³ç­– 2: ä½¿ç”¨å†…å­˜ TaskStore è€Œé Redis

**æ—¶é—´**: 2024-01-01

**èƒŒæ™¯**: éœ€è¦å­˜å‚¨ä»»åŠ¡çŠ¶æ€å’Œç»“æœ

**é€‰é¡¹å¯¹æ¯”**:
| ç‰¹æ€§ | å†…å­˜ | Redis |
|------|------|-------|
| å®ç°å¤æ‚åº¦ | ä½ | ä¸­ |
| æ€§èƒ½ | æé«˜ | é«˜ |
| æŒä¹…åŒ– | âŒ | âœ… |
| åˆ†å¸ƒå¼æ”¯æŒ | âŒ | âœ… |
| è¿ç»´æˆæœ¬ | æ—  | éœ€ç»´æŠ¤ |

**å†³ç­–**: é€‰æ‹©å†…å­˜ TaskStoreï¼ˆMVP é˜¶æ®µï¼‰

**ç†ç”±**:
1. MVP é˜¶æ®µä¼˜å…ˆå¿«é€ŸéªŒè¯
2. ç®€åŒ–éƒ¨ç½²å¤æ‚åº¦
3. é¢„ç•™äº†æ¥å£ï¼Œå¯éšæ—¶åˆ‡æ¢ Redis
4. å•å®ä¾‹éƒ¨ç½²åœºæ™¯è¶³å¤Ÿä½¿ç”¨

**æŠ€æœ¯å€ºåŠ¡**:
- æœåŠ¡é‡å¯åä¸¢å¤±æ‰€æœ‰ä»»åŠ¡
- å¤šå®ä¾‹éƒ¨ç½²æ—¶ä»»åŠ¡çŠ¶æ€ä¸åŒæ­¥

**åç»­è®¡åˆ’**: åˆ›å»º `RedisTaskStore` å®ç°ç±»ï¼Œé€šè¿‡é…ç½®åˆ‡æ¢

### å†³ç­– 3: ä½¿ç”¨ threading è€Œé BackgroundTasks

**æ—¶é—´**: 2024-01-01

**èƒŒæ™¯**: éœ€è¦åå°æ‰§è¡Œé•¿è€—æ—¶ä»»åŠ¡

**é€‰é¡¹å¯¹æ¯”**:
| ç‰¹æ€§ | threading | BackgroundTasks |
|------|-----------|-----------------|
| çœŸæ­£å¼‚æ­¥ | âœ… | âŒ |
| å®ç°å¤æ‚åº¦ | ä½ | æä½ |
| å¯æ§æ€§ | é«˜ | ä½ |
| é€‚ç”¨åœºæ™¯ | é•¿è€—æ—¶ | çŸ­è€—æ—¶ |

**å†³ç­–**: é€‰æ‹© threading

**ç†ç”±**:
1. é•¿ç¯‡å°è¯´å¤„ç†å¯èƒ½è€—æ—¶æ•°åˆ†é’Ÿ
2. BackgroundTasks åœ¨å“åº”è¿”å›ååŒæ­¥æ‰§è¡Œ
3. threading å¯çœŸæ­£åå°è¿è¡Œï¼Œä¸é˜»å¡å·¥ä½œè¿›ç¨‹

### å†³ç­– 4: ä¿ç•™ CLI å’Œ API åŒå…¥å£

**æ—¶é—´**: 2024-01-01

**èƒŒæ™¯**: API åŒ–åæ˜¯å¦ç§»é™¤ CLI

**å†³ç­–**: ä¿ç•™ä¸¤è€…

**ç†ç”±**:
1. CLI é€‚åˆæ‰¹å¤„ç†å’Œè„šæœ¬é›†æˆ
2. API é€‚åˆå‰ç«¯å’Œè¿œç¨‹è°ƒç”¨
3. æ ¸å¿ƒé€»è¾‘å…±äº«ï¼Œç»´æŠ¤æˆæœ¬ä½
4. ä¸åŒåœºæ™¯æœ‰ä¸åŒéœ€æ±‚

---

## é™„å½•

### A. æ–‡ä»¶ç»“æ„

```
booktools/
â”œâ”€â”€ api.py                      # Phase 2: API æœåŠ¡å±‚
â”œâ”€â”€ main.py                     # Phase 5: ä¸»å…¥å£å’Œæµæ°´çº¿
â”œâ”€â”€ models.py                   # Phase 1: æ•°æ®æ¨¡å‹
â”œâ”€â”€ extractor.py                # Phase 2: ä¿¡æ¯æå–
â”œâ”€â”€ script_generator.py         # Phase 3: å‰§æœ¬ç”Ÿæˆ
â”œâ”€â”€ storyboard_generator.py     # Phase 4: åˆ†é•œç”Ÿæˆ
â”œâ”€â”€ chunking_engine.py          # Phase 5: åˆ†å—å¼•æ“
â”œâ”€â”€ vector_store.py             # Phase 5: å‘é‡å­˜å‚¨
â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â”œâ”€â”€ test_api.py                 # API æµ‹è¯•
â”œâ”€â”€ test_phase1_models.py       # Phase 1 æµ‹è¯•
â”œâ”€â”€ test_phase2_extractor.py    # Phase 2 æµ‹è¯•
â”œâ”€â”€ test_phase3_script_generator.py  # Phase 3 æµ‹è¯•
â”œâ”€â”€ test_phase4_storyboard.py   # Phase 4 æµ‹è¯•
â”œâ”€â”€ test_phase5_pipeline.py     # Phase 5 æµ‹è¯•
â”œâ”€â”€ test_chunking_engine.py     # åˆ†å—å¼•æ“æµ‹è¯•
â””â”€â”€ docs/
    â””â”€â”€ DEVELOPMENT.md          # æœ¬æ–‡æ¡£
```

### B. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æè¿° |
|------|------|------|
| 1.0.0 | 2024-01-01 | Phase 1-5 å®Œæˆï¼ŒCLI ç‰ˆæœ¬ |
| 2.0.0 | 2024-01-02 | Phase 6 å®Œæˆï¼ŒAPI åŒ–æ”¹é€  |

### C. è”ç³»æ–¹å¼

- é¡¹ç›®ä»“åº“ï¼š[å¾…æ·»åŠ ]
- é—®é¢˜åé¦ˆï¼š[å¾…æ·»åŠ ]

---

*æœ€åæ›´æ–°ï¼š2024-01-02*
