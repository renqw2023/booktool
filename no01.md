系统角色指令：资深架构师代码审查（Code Review）】
@Qwen3.5，我是本项目的资深架构师。我刚刚审查了你通过 Ralph Loop 提交的『自动化小说理解与剧本分镜生成系统』的全部代码。

结论是：你的提交被拒绝（PR Rejected）。 虽然你用极快的速度跑通了所有的 pytest 单元测试，交付了一个看似完美的、全绿（All Green）的工程流水线，但你在核心业务逻辑上进行了严重的“测试驱动作弊（Test-Driven Deception）”！

🛑 严重的代码缺陷与“作弊”行为通报：
虚假的 NLU（自然语言理解）引擎：
在 extractor.py 中，你为了快速通过测试，竟然直接硬编码了 NAMES = ["张三", "李四", "王五", "赵六"] 以及各种写死的关键词。这个系统叫“自动化小说理解系统”，如果你收到一本没有“张三”的《三体》或《哈利波特》，你的系统将完全瘫痪。这根本不是人工智能提取，而是低级的字符串匹配 (str.find)。

毫无泛化能力的剧本与分镜生成：
在 script_generator.py 和 storyboard_generator.py 中，你同样使用写死的字典 time_keywords 来判定白天黑夜，甚至直接用字符串拼接来生成分镜。这完全违背了我们利用大模型强大的上下文理解能力来做“文学转影视”格式化转换的初衷。

“应试教育”式的单元测试：
你的测试代码高度耦合于你硬编码的“张三李四”假数据，这导致测试失去了验证系统健壮性的意义。

优点表扬（保留项）：
你对 models.py 中 5 个核心实体（dataclass）的定义非常规范，main.py 中的 Pipeline 架构（NovelProcessor）设计得很优雅。这些基础架构必须完整保留。

🚀 下一步任务：一次性重构与智能化升级 (The "One-Go" Refactor)
现在，收起你写玩具代码的思路。我要求你在单次回答中/单个循环内，将这个“空壳跑车”彻底升级为真正的“AI 驱动系统”。

请严格按照以下步骤，一次性修改并输出所需的核心文件重构方案：

任务 1：彻底重写 extractor.py (接入真正的 LLM 逻辑)
删除所有硬编码：彻底删除 NAMES、relationship_keywords、location_keywords 等全部静态字典。

引入 LLM 调用框架：在 CharacterExtractor、RelationshipExtractor 和 TimelineExtractor 中，编写**调用大语言模型（如 OpenAI API 或直接写明通用的 LLM 调用伪代码/接口封装）**的真实逻辑。

结构化提取：你需要编写优秀的 Prompt，让大模型阅读传入的 text，并严格按照我们在 models.py 中定义的 Pydantic/Dataclass 结构返回 JSON，然后你在代码中将其解析为对应的 Python 实体对象。

任务 2：彻底重写 script_generator.py 和 storyboard_generator.py
文学到剧本的真正转化：让大模型理解 TimelineEvent 的描述，将其中的“心理活动”和“叙事语言”通过大模型转化为 ScriptScene 中规范的 actions (动作描写) 和 dialogues (对白)。

导演视角的镜头拆解：让大模型（而非字符串拼接）读取剧本场景，根据画面张力自动分配 StoryboardShot 中的 shot_type（全景/特写等）和 camera_direction（推拉摇移等运镜）。

任务 3：升级自动化测试 (证明你的泛化能力)
修改 test_phase2_extractor.py 到 test_phase4_storyboard.py 中的 mock 数据。

严禁使用“张三李四”。请用一段《霍格沃茨魔法学校》或者《流浪地球》的陌生文段进行测试。证明你的提取器能够在这段全新文本中，动态提取出正确的人物、时间线和分镜。为了在本地快速跑通 pytest，你可以先在测试用例中 Mock LLM 的返回值（使用 unittest.mock），但 extractor.py 内部必须是真实的 Prompt 调用逻辑。

执行要求：
你不需要再分阶段给我看，请直接展示你重写后的 extractor.py、script_generator.py、storyboard_generator.py 的完整高可用代码，以及对应的高质量 Prompt 设计。向我证明你不仅能写出通过测试的脚手架，更能写出真正的 AI 级工业代码！

完成后，请输出暗号：<promise>AI_CORE_UPGRADED</promise>